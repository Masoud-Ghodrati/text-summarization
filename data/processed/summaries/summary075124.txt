NEW: Yemeni parliament extends emergency law for 30 days.
President Saleh agrees to a new constitution and elections.
The opposition previously rejected any plan without Saleh's immediate ouster.
Some government, military officials have joined the opposition.
